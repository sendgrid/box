# Demo Sending Email with Attachment Stored in Box

## Installation

Get your [SendGrid Account](https://app.sendgrid.com/signup?source=boxdev)

Get your [Box Credentials](https://app.box.com/developers/services/edit/)

```bash
git clone https://github.com/sendgrid/box.git
cd box
virtualenv venv
source ./venv/bin/activate
pip install -r requirements.txt
```

Update credentials in `.env_sample`.

```bash
mv .env_sample .env
source ./.env
```

Update configuration variables in [config.yml](https://github.com/sendgrid/box/blob/master/config.yml#L36).

## Execution

Update credentials in `.env_sample`.

Update configuration variables in [config.yml](https://github.com/sendgrid/box/blob/master/config.yml#L36).

```bash
source ./venv/bin/activate
source ./.env
python send_demo.py
```

# Demo Receiving Email with Attachment Stored in Box

## Installation

Get your [SendGrid Account](https://app.sendgrid.com/signup?source=boxdev)

Get your [Box Credentials](https://app.box.com/developers/services/edit/)

```bash
git clone https://github.com/sendgrid/box.git
cd box
virtualenv venv
source ./venv/bin/activate
pip install -r requirements.txt
```

Update credentials in `.env_sample`. Set AWS to True if deploying to Amazon Cloud.

```bash
mv .env_sample .env
source ./.env
```

Update configuration variables in [config.yml](https://github.com/sendgrid/box/blob/master/config.yml#L36).

## Local Execution

Setup your [MX records](https://sendgrid.com/docs/Classroom/Basics/Inbound_Parse_Webhook/setting_up_the_inbound_parse_webhook.html#-Setup). Depending on your domain name host, you may need to wait up to 48 hours for the settings to propagate.

Update credentials in `.env_sample`.

Update configuration variables in [config.yml](https://github.com/sendgrid/box/blob/master/config.yml#L36).

```bash
source ./venv/bin/activate
source ./.env
python receive_demo.py
```

Open another terminal:

Install [ngrok](https://ngrok.com/download).

```bash
ngrok http 5000
```

Update your SendGrid Incoming Parse settings: [Settings Page](https://app.sendgrid.com/settings/parse) | [Docs](https://sendgrid.com/docs/Classroom/Basics/Inbound_Parse_Webhook/setting_up_the_inbound_parse_webhook.html#-Pointing-to-a-Hostname-and-URL)

- For the HOSTNAME field, use the domain that you changed the MX records (e.g. inbound.yourdomain.com)
- For the URL field, use the URL generated by ngrok + /inbound, e.g http://XXXXXXX.ngrok.io/inbound

Next, send an email to [anything]@inbound.yourdomain.com with an attachment, then look at the terminal where you started the Inbound Parse listener.

Check your Box account. The attached file should be located in the folder specified in `config.yml`

## Deploy to AWS

```bash
deactivate
pip install awsebcli
source ./venv/bin/activate
eb init -p python2.7 inbound-parse
eb create inbound-parse2-env
eb setenv CLIENT_ID='YOUR_CLIENT_ID'
eb setenv CLIENT_SECRET='YOUR_CLIENT_SECRET'
eb setenv DEVELOPER_TOKEN='YOUR_DEVELOPER_TOKEN'
eb setenv AWS='True'
eb open
```

Use that URL + /inbound as the value of the URL field at your [SendGrid Parse settings page](https://app.sendgrid.com/settings/parse).

For subsequent updates to your code, after commiting your code use the following command to update:

```bash
eb deploy inbound-parse2-env
```

When you are done, stop the server with:

```bash
eb terminate inbound-parse2-env
```
